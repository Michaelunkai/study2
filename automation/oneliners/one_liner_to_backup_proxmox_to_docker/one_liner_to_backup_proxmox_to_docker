mkdir /backup && mkdir /backup/dump && mkdir /backup/template && rsync -aP /var/lib/vz/dump/* /backup/dump && rsync -aP /var/lib/vz/template/* /backup/template && rsync -aP /Dockerfile /backup && split_size=$(( $(du -s /backup | awk '{print $1}') / 5 + 1 ))
tar -czvf - /backup 2>/dev/null | split -b "${split_size}K" - /archive- && mkdir /a && mkdir /b && mkdir /c && mkdir /d && mkdir /e && mv archive-aa /a/ && mv archive-ab /b/ && mv archive-ac /c/ && mv archive-ad /d/ && mv archive-ae /e/ && cp /Dockerfile /a/ && cp /Dockerfile /b/ && cp Dockerfile /c/ && cp Dockerfile /d/ && cp Dockerfile /e/ &&  cd /a && docker build -t michadockermisha/backup:prox1 . && docker push michadockermisha/backup:prox1 && cd ../b && docker build -t michadockermisha/backup:prox2 . && docker push michadockermisha/backup:prox2 && cd ../c && docker build -t michadockermisha/backup:prox3 . && docker push michadockermisha/backup:prox3 && cd ../d && docker build -t michadockermisha/backup:prox4 . && docker push michadockermisha/backup:prox4 && cd ../e && docker build -t michadockermisha/backup:prox5 . && docker push michadockermisha/backup:prox5
