sudo -u postgres psql -c "SELECT pg_database.datname, pg_size_pretty(pg_database_size(pg_database.datname)) AS size FROM pg_database;" > db_sizes.txt && sudo -u postgres psql -c "SELECT schemaname, relname, n_live_tup, n_dead_tup, last_vacuum, last_autovacuum FROM pg_stat_user_tables ORDER BY n_dead_tup DESC LIMIT 10;" > table_stats.txt && sudo -u postgres vacuumdb --all --analyze-in-stages && sudo -u postgres reindexdb --all && sudo -u postgres pg_dump -C -w -F tar -f backup.tar postgres && echo "Database maintenance completed. Check db_sizes.txt and table_stats.txt for details."
