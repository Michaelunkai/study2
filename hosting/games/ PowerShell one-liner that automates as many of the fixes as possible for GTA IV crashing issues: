Start-Process "cmd.exe" -ArgumentList "/c taskkill /f /im gtaiv.exe" -NoNewWindow; Start-Sleep -Seconds 3; Write-Host "Stopping GTA IV if running..."; $ErrorActionPreference = "SilentlyContinue"; Write-Host "Updating Windows..."; Start-Process "cmd.exe" -ArgumentList "/c wuauclt /detectnow" -NoNewWindow; Write-Host "Installing DirectX 9 & Visual C++ Redists..."; $dx9 = "https://download.microsoft.com/download/6/5/6/65621B9C-7D4E-49F6-8381-FDE7F0DC8B3A/directx_Jun2010_redist.exe"; $vc = "https://aka.ms/vs/17/release/vc_redist.x64.exe"; Invoke-WebRequest -Uri $dx9 -OutFile "$env:TEMP\dx9.exe"; Start-Process "$env:TEMP\dx9.exe" -ArgumentList "/q /t:%TEMP%\DX9Install" -NoNewWindow -Wait; Start-Process "$env:TEMP\DX9Install\DXSETUP.exe" -ArgumentList "/silent" -NoNewWindow -Wait; Invoke-WebRequest -Uri $vc -OutFile "$env:TEMP\vc_redist.exe"; Start-Process "$env:TEMP\vc_redist.exe" -ArgumentList "/install /quiet /norestart" -NoNewWindow -Wait; Write-Host "Disabling overlays..."; Stop-Process -Name "steam" -Force -ErrorAction SilentlyContinue; Stop-Process -Name "nvcontainer" -Force -ErrorAction SilentlyContinue; Stop-Process -Name "discord" -Force -ErrorAction SilentlyContinue; Stop-Process -Name "RadeonSoftware" -Force -ErrorAction SilentlyContinue; Write-Host "Clearing GTA IV settings..."; Remove-Item "$env:USERPROFILE\Documents\Rockstar Games\GTA IV" -Recurse -Force -ErrorAction SilentlyContinue; Write-Host "Updating Graphics Drivers..."; Start-Process "cmd.exe" -ArgumentList "/c pnputil /scan-devices" -NoNewWindow -Wait; Write-Host "Setting GTA IV to use RTX 4090..."; $regPath = "HKCU:\Software\Microsoft\DirectX\UserGpuPreferences"; if (!(Test-Path $regPath)) { New-Item -Path $regPath -Force | Out-Null }; Set-ItemProperty -Path $regPath -Name "GTAIV.exe" -Value "GpuPreference=2"; Write-Host "Verifying GTA IV files on Steam..."; Start-Process "cmd.exe" -ArgumentList "/c steam://validate/12210" -NoNewWindow; Write-Host "Forcing CPU affinity..."; Start-Process "cmd.exe" -ArgumentList "/c wmic process where name='GTAIV.exe' CALL setpriority 32768" -NoNewWindow -Wait; Write-Host "Clearing shader cache..."; Remove-Item "C:\Users\$env:USERNAME\AppData\Local\NVIDIA\DXCache\*" -Recurse -Force -ErrorAction SilentlyContinue; Remove-Item "C:\Users\$env:USERNAME\AppData\Local\AMD\DxCache\*" -Recurse -Force -ErrorAction SilentlyContinue; Write-Host "Rebooting system..."; Start-Sleep -Seconds 5; Restart-Computer -Force
